	IF OBJECT_ID('tempdb..#rtemp') IS NOT NULL
    DROP TABLE #rtemp;
select  a.loan_skey,a.original_loan_number,
--a.original_loan_number, 
a.loan_sub_status_description as loan_sub_status,a.investor_name,a.loan_status_description,
c.contact_type_description as 'Contact Type'
,c.first_name as 'Contact First Name',c.last_name as 'Contact Last Name' 
,b.address1 as 'Property Address1',b.address2 as 'Property Address2' ,b.city as 'Property City' 
,b.state_code as 'Property State',b.zip_code as 'Property Zip'
,c.mail_address1 as 'Mailing Address 1' ,c.mail_address2 as 'Mailing Address 2',c.mail_city as 'Mailing City'
,c.mail_state_code as 'Mailing State' ,c.mail_zip_code as 'Mailing Zip',c.home_phone_number as 'Home Phone #',c.cell_phone_number as 'Cell Phone #'
,c.work_phone_number as 'Work Phone #'
--,b.curtailment_reason_description,b.date_foreclosure_sale_held,b.date_foreclosure_sale_scheduled
--,d.alert_type_description
--,d.alert_status_description
, case when c.contact_type_description in
		('Attorney','Borrower','Co-Borrower','Legal Owner',
		'Entitled Non-Borrowing Spouse','Alternate Contact','Authorized Party','Executor','Power of Attorney','Trustee',
		'Non-Borrowing Spouse','Conservator','Guardian','Authorized Designee')
		then 1 else 0 end as 'Has Valid Number'
into #rtemp
from reversequest.rms.v_LoanMaster a
join
[ReverseQuest].[rms].[v_PropertyMaster] b
on a.loan_skey=b.loan_skey
join reversequest.rms.v_ContactMaster c
on a.loan_skey = c.loan_skey
--join reversequest.rms.v_Alert d
--on a.loan_skey=d.loan_skey
where 
--a.loan_status_description not in ('DELETED', 'INACTIVE') 
a.loan_status_description not in ('DELETED', 'INACTIVE','BANKRUPTCY','INACTIVE','REO','BNK/DEF','BNK/FCL') 
and  ((len(c.home_phone_number)>=10 and c.home_phone_number <>'9999999999' and c.home_phone_number <> '4444444444')or (len(c.cell_phone_number)>=10 and c.cell_phone_number <> '9999999999' and c.cell_phone_number <> '4444444444') or
((len(c.work_phone_number)>=10) and c.work_phone_number <> '9999999999' and c.work_phone_number <> '4444444444') and c.contact_type_description = 'Attorney')
--and d.alert_status_description = 'Active'
and c.contact_type_description in
		('Attorney','Borrower','Co-Borrower','Legal Owner',
		'Entitled Non-Borrowing Spouse','Alternate Contact','Authorized Party','Executor','Power of Attorney','Trustee',
		'Non-Borrowing Spouse','Conservator','Guardian','Authorized Designee')
and a.loan_skey in('13402',
'13541',
'13598',
'13817',
'13838',
'13853',
'13869',
'14032',
'14386',
'14417',
'14883',
'15015',
'15153',
'15237',
'15475',
'15773',
'15773',
'19451',
'22299',
'22701',
'27767',
'28789',
'33615',
'33703',
'41685',
'42503',
'42597',
'42953',
'43023',
'68962',
'74566',
'75507',
'75507',
'78592',
'78592',
'79108',
'79722',
'79888',
'80193',
'80244',
'82208',
'82388',
'83088',
'83368',
'84832',
'84832',
'86014',
'90330',
'102721',
'103631',
'104184',
'104636',
'104667',
'104850',
'104905',
'104910',
'104947',
'104999',
'104999',
'105006',
'105722',
'106393',
'107557',
'108109',
'108239',
'108728',
'108981',
'109529',
'109982',
'109993',
'109993',
'111834',
'111845',
'111858',
'113805',
'113903',
'124358',
'125457',
'125497',
'125555',
'125639',
'125839',
'125852',
'126232',
'127137',
'127403',
'127620',
'133241',
'140258',
'146448',
'149376',
'150213',
'150344',
'150345',
'151051',
'151051',
'151156',
'153462',
'164988',
'164988',
'165024',
'165130',
'165130',
'165434',
'165574',
'165857',
'166095',
'166387',
'166741',
'167431',
'168492',
'168492',
'175434',
'180693',
'181877',
'181877',
'182510',
'182578',
'186733',
'186965',
'186993',
'187384',
'187384',
'187591',
'187746',
'188120',
'188400',
'188599',
'188640',
'189088',
'189088',
'200620',
'200737',
'200782',
'200904',
'201172',
'201371',
'201438',
'201548',
'201748',
'201792',
'201800',
'201908',
'201946',
'202022',
'202071',
'202071',
'202086',
'202086',
'202156',
'202156',
'202260',
'202260',
'202326',
'202327',
'202327',
'202401',
'202443',
'202518',
'202518',
'202855',
'202875',
'202901',
'202901',
'203147',
'203371',
'203451',
'203451',
'203503',
'203506',
'203518',
'203871',
'203885',
'203885',
'204073',
'204153',
'204311',
'204311',
'204369',
'204535',
'204729',
'205329',
'205883',
'205932',
'205934',
'205945',
'206255',
'206255',
'206932',
'207313',
'207414',
'207765',
'208044',
'208344',
'208754',
'208885',
'209298',
'209298',
'209577',
'210762',
'211004',
'211004',
'211125',
'211152',
'211431',
'212757',
'212774',
'212775',
'212922',
'213118',
'213203',
'213313',
'214458',
'214458',
'214791',
'214791',
'215041',
'215472',
'215515',
'215517',
'215517',
'215564',
'215629',
'215629',
'215719',
'215719',
'215728',
'215882',
'216082',
'216092',
'216178',
'216325',
'216325',
'217664',
'217698',
'217739',
'217776',
'217930',
'217936',
'217992',
'218037',
'218049',
'218053',
'218054',
'218097',
'218128',
'218138',
'218180',
'218187',
'218352',
'218818',
'219197',
'219298',
'219542',
'219546',
'219620',
'220010',
'220013',
'220056',
'220150',
'220165',
'220386',
'220399',
'220404',
'220485',
'220575',
'220575',
'220608',
'221103',
'221173',
'221173',
'221224',
'221224',
'221558',
'221673',
'222114',
'222597',
'222610',
'222663',
'222805',
'222916',
'223003',
'223031',
'223059',
'223164',
'223223',
'223377',
'223501',
'223587',
'223598',
'223652',
'223690',
'223716',
'223716',
'223765',
'223903',
'223903',
'224013',
'224013',
'224120',
'224123',
'224123',
'224234',
'224252',
'224291',
'224334',
'224437',
'224451',
'224451',
'224568',
'224635',
'225208',
'225397',
'225452',
'225457',
'225648',
'225649',
'225750',
'225759',
'225853',
'225920',
'226434',
'227059',
'227337',
'227378',
'227925',
'228676',
'229359',
'229424',
'229444',
'229684',
'229814',
'230707',
'230950',
'231021',
'231304',
'231360',
'231496',
'232328',
'232430',
'232808',
'232990',
'233491',
'233979',
'234155',
'235349',
'235423',
'235432',
'235870',
'236175',
'236479',
'236491',
'236609',
'236734',
'236740',
'236778',
'236922',
'237013',
'237112',
'237647',
'237682',
'237683',
'238139',
'238661',
'239481',
'240259',
'240285',
'240444',
'241074',
'241074',
'241085',
'241147',
'242035',
'243026',
'243110',
'243883',
'243883',
'244436',
'244472',
'245438',
'245532',
'245565',
'245621',
'246170',
'246233',
'246310',
'246326',
'246420',
'246569',
'246970',
'247097',
'247470',
'247622',
'248024',
'248025',
'248121',
'248135',
'248673',
'248674',
'248690',
'249633',
'249639',
'249759',
'249996',
'250453',
'251198',
'252580',
'252581',
'253575',
'253768',
'253782',
'255216',
'255290',
'255300',
'255595',
'255727',
'255813',
'256503',
'256744',
'257670',
'257903',
'258189',
'258824',
'258882',
'258882',
'260613',
'260811',
'261266',
'261488',
'261729',
'261752',
'261766',
'261868',
'261868',
'261911',
'261989',
'262136',
'262144',
'262172',
'262257',
'262313',
'262390',
'262390',
'262438',
'262438',
'262572',
'262572',
'262611',
'262738',
'262738',
'262738',
'262744',
'262744',
'262814',
'262814',
'262825',
'262827',
'262943',
'262944',
'262951',
'262954',
'262954',
'262960',
'262988',
'262988',
'263025',
'263063',
'263104',
'263109',
'263265',
'263283',
'263316',
'263316',
'263420',
'263420',
'263533',
'263547',
'263559',
'263668',
'263722',
'263722',
'263760',
'263799',
'263799',
'263811',
'263971',
'263971',
'263973',
'264003',
'264154',
'264166',
'264166',
'264329',
'264409',
'264409',
'264617',
'264617',
'264639',
'264735',
'264735',
'264893',
'264916',
'264916',
'264935',
'264959',
'265447',
'265447',
'265557',
'265557',
'265756',
'265756',
'265939',
'265972',
'266018',
'266092',
'266092',
'266191',
'266265',
'266327',
'266327',
'266380',
'266380',
'266586',
'266734',
'266734',
'266921',
'266921',
'267016',
'267068',
'267078',
'267139',
'267235',
'267309',
'267312',
'267316',
'267342',
'267533',
'267581',
'267825',
'267825',
'267873',
'267892',
'267898',
'267911',
'267911',
'267987',
'267987',
'268059',
'268294',
'268374',
'268433',
'268445',
'268445',
'269180',
'270917',
'270919',
'271062',
'271062',
'271099',
'271131',
'271154',
'271192',
'271410',
'272041',
'272041',
'272094',
'272618',
'272734',
'272776',
'272776',
'272867',
'272869',
'272887',
'272903',
'272906',
'273273',
'273372',
'273725',
'274357',
'274521',
'274676',
'274702',
'275111',
'275111',
'275314',
'275314',
'275448',
'275448',
'275536',
'275859',
'275879',
'276192',
'276196',
'276338',
'276514',
'276537',
'276537',
'276690',
'276721',
'276818',
'277296',
'277533',
'277565',
'277867',
'278151',
'278172',
'278235',
'278753',
'278753',
'279362',
'279565',
'279823',
'279823',
'279994',
'280126',
'280242',
'280242',
'280317',
'280494',
'280959',
'280959',
'281678',
'281678',
'281935',
'281959',
'282024',
'282024',
'282063',
'282108',
'283256',
'283586',
'283644',
'283903',
'284014',
'284613',
'284896',
'284945',
'284945',
'285195',
'285220',
'285307',
'285307',
'285378',
'285477',
'285732',
'285869',
'286005',
'286091',
'286199',
'286291',
'287391',
'287665',
'288198',
'288203',
'288440',
'288443',
'288891',
'288946',
'288946',
'291498',
'291564',
'292228',
'293613',
'293714',
'293760',
'293987',
'294375',
'294759',
'294985',
'295262',
'295833',
'296662',
'296667',
'296880',
'296880',
'296989',
'296989',
'297278',
'297557',
'297798',
'297810',
'298086',
'298143',
'298251',
'299160',
'299326',
'299718',
'299891',
'299971',
'299971',
'300082',
'300339',
'300759',
'301096',
'301098',
'301578',
'301658',
'302088',
'302425',
'302426',
'302426',
'302601',
'302659',
'303333',
'303373',
'303543',
'303543',
'304022',
'304022',
'305075',
'305075',
'305431',
'305487',
'306021',
'306089',
'306767',
'306835',
'306845',
'306989',
'307614',
'307614',
'307812',
'307912',
'307912',
'308090',
'308182',
'308462',
'308719',
'308729',
'308786',
'309016',
'309230',
'309542',
'309577',
'309654',
'310191',
'310374',
'311018',
'311143',
'311286',
'311677',
'312372',
'312465',
'312600',
'312821',
'313048',
'313260',
'313260',
'313268',
'313268',
'313315',
'313354',
'313483',
'313601',
'313887',
'313930',
'316031',
'316711',
'316830',
'317552',
'317876',
'317970',
'318216',
'318294',
'318466',
'319403',
'319584',
'319778',
'319937',
'320118',
'320196',
'320196',
'320366',
'320668',
'320903',
'321146',
'321156',
'321397',
'321399',
'321523',
'322223',
'322248',
'322403',
'322600',
'322605',
'322614',
'322615',
'322681',
'322684',
'322684',
'322695',
'322841',
'323064',
'323137',
'323169',
'323180',
'323222',
'323375',
'323455',
'323455',
'323520',
'323535',
'323554',
'323675',
'323713',
'323774',
'323782',
'323782',
'349787',
'349790',
'516177',
'536228',
'558975',
'582001'
)
order by loan_skey;

delete from #rtemp
where loan_skey in
(select a.loan_skey from reversequest.rms.v_note a
where a.created_date
>= DATEADD(d,-6,DATEDIFF(d,0,GETDATE())) and
a.created_date < DATEADD(d,1,DATEDIFF(d,0,GETDATE()))
and a.note_type_description like 'Contact - RPC' and a.created_by in ('Vishnu V Thannickal','Mohit Gandhi')
);

delete from #rtemp
where loan_skey in
(select a.loan_skey from reversequest.rms.v_note a
where a.created_date
>= DATEADD(d,-7,DATEDIFF(d,0,GETDATE())) and
a.created_date < DATEADD(d,0,DATEDIFF(d,0,GETDATE()))
and a.note_type_description like 'Contact - RPC' and a.created_by not in ('Vishnu V Thannickal','Mohit Gandhi')
);

select * from #rtemp where loan_skey not in (
select loan_skey from [ReverseQuest].[rms].[v_Alert]
where alert_type_description  in ('SKPADD','SKPEML','SKPEXH','SKPTRC','FDCPA -  Call Restrictions','Cease and Desist','Pending Cease and Desist','LITIGATION - Lawsuit Pending','DVN Research Request Pend')
and alert_status_description = 'Active');